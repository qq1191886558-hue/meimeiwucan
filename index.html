<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Love Management System Â· å¤–å–ç‰ˆ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang SC", "Hiragino Sans GB", "Microsoft YaHei", sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            overflow-x: hidden;
        }

        .container {
            width: 100%;
            max-width: 420px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 24px;
            padding: 32px 24px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
        }

        .header {
            text-align: center;
            margin-bottom: 32px;
        }

        .title {
            font-size: 24px;
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 8px;
        }

        .subtitle {
            font-size: 14px;
            color: #718096;
        }

        .time-badge {
            display: inline-block;
            padding: 6px 12px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            font-size: 12px;
            margin-top: 8px;
        }

        .card-container {
            position: relative;
            height: 280px;
            margin-bottom: 32px;
            perspective: 1000px;
        }

        .card {
            position: absolute;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 10px 30px rgba(102, 126, 234, 0.3);
            transition: all 0.6s cubic-bezier(0.68, -0.55, 0.265, 1.55);
            transform-style: preserve-3d;
        }

        .card.shuffle {
            animation: shuffle 0.6s ease-in-out;
        }

        @keyframes shuffle {
            0%, 100% { transform: rotateY(0deg) scale(1); }
            50% { transform: rotateY(180deg) scale(0.8); }
        }

        .card-icon {
            font-size: 64px;
            margin-bottom: 16px;
            filter: drop-shadow(0 4px 8px rgba(0, 0, 0, 0.2));
        }

        .card-title {
            font-size: 28px;
            font-weight: 600;
            margin-bottom: 12px;
        }

        .card-description {
            font-size: 15px;
            opacity: 0.9;
            text-align: center;
            padding: 0 20px;
            line-height: 1.6;
        }

        .main-button {
            width: 100%;
            padding: 16px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 16px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
            margin-bottom: 16px;
        }

        .main-button:active {
            transform: scale(0.98);
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.4);
        }

        .main-button:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .action-buttons {
            display: none;
            gap: 12px;
            margin-top: 16px;
        }

        .action-buttons.show {
            display: flex;
        }

        .action-btn {
            flex: 1;
            padding: 14px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-confirm {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 12px rgba(72, 187, 120, 0.3);
        }

        .btn-retry {
            background: white;
            color: #667eea;
            border: 2px solid #667eea;
        }

        .btn-confirm:active {
            transform: scale(0.98);
        }

        .btn-retry:active {
            transform: scale(0.98);
        }

        .stats {
            text-align: center;
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e2e8f0;
            font-size: 13px;
            color: #718096;
        }

        .special-message {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            background: white;
            padding: 32px 24px;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            text-align: center;
            z-index: 1000;
            max-width: 340px;
            width: 90%;
            transition: all 0.4s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }

        .special-message.show {
            transform: translate(-50%, -50%) scale(1);
        }

        .special-message-icon {
            font-size: 56px;
            margin-bottom: 16px;
        }

        .special-message-text {
            font-size: 18px;
            line-height: 1.6;
            color: #2d3748;
            margin-bottom: 20px;
            white-space: pre-line;
        }

        .special-message-btn {
            width: 100%;
            padding: 14px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .overlay.show {
            opacity: 1;
            pointer-events: auto;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fade-in {
            animation: fadeIn 0.5s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="title">Leave It to Me</div>
            <div class="subtitle">ğŸ’—æ¢…æ¢…ğŸ’—ä¸“å±åˆé¤å†³ç­–ç³»ç»Ÿ</div>
            <div class="time-badge" id="timeBadge">åŠ è½½ä¸­...</div>
        </div>

        <div class="card-container">
            <div class="card" id="resultCard">
                <div class="card-icon">ğŸ¯</div>
                <div class="card-title">å‡†å¤‡å¥½äº†å—</div>
                <div class="card-description">ä¸ç”¨çº ç»“ï¼Œè®©æˆ‘å¸®ä½ å†³å®š</div>
            </div>
        </div>

        <button class="main-button" id="drawButton">å¼€å§‹æŠ½å–</button>

        <div class="action-buttons" id="actionButtons">
            <button class="action-btn btn-confirm" id="confirmBtn">å°±å®ƒäº† âœ…</button>
            <button class="action-btn btn-retry" id="retryBtn">æˆ‘å†çº ç»“ä¸€ä¸‹</button>
        </div>

        <div class="stats" id="stats">
            ä»Šæ—¥å·²ä¸ºä½ å†³ç­– <span id="todayCount">0</span> æ¬¡
        </div>
    </div>

    <div class="overlay" id="overlay"></div>
    <div class="special-message" id="specialMessage">
        <div class="special-message-icon" id="specialIcon">â¤ï¸</div>
        <div class="special-message-text" id="specialText"></div>
        <button class="special-message-btn" id="specialBtn">å¥½çš„</button>
    </div>

    <script>
        // ==================== é…ç½®åŒº ====================
        
        // ã€å¯ä¿®æ”¹ã€‘å¤–å–é€‰é¡¹æ±  - æŒ‰æ—¶æ®µåˆ†ç±»
        // æ—¶æ®µæ ‡ç­¾è¯´æ˜ï¼š
        // 'breakfast' - æ—©é¤ (6:00-10:30)
        // 'lunch' - åˆé¤ (10:30-14:00)
        // 'afternoon' - ä¸‹åˆèŒ¶ (14:00-17:00)
        // 'dinner' - æ™šé¤ (17:00-21:00)
        // 'night' - å¤œå®µ (21:00-æ¬¡æ—¥6:00)
        // 'anytime' - å…¨æ—¶æ®µ
        
        const foodOptions = [
            // ğŸŒ… æ—©é¤ä¸“å±
            { name: 'è±†æµ†æ²¹æ¡', icon: 'ğŸ¥–', reason: 'ä¼ ç»Ÿçš„æ—©æ™¨ï¼Œå…ƒæ°”æ»¡æ»¡', category: 'safe', time: ['breakfast'] },
            { name: 'è‚ ç²‰', icon: 'ğŸš', reason: 'æ»‘å«©æ¸…æ·¡ï¼Œæ¸©æŸ”çš„å¼€å§‹', category: 'comfort', time: ['breakfast', 'lunch'] },
            { name: 'åŒ…å­ç²¥', icon: 'ğŸ¥Ÿ', reason: 'çƒ­ä¹ä¹çš„ï¼Œèƒƒä¼šå¾ˆèˆ’æœ', category: 'comfort', time: ['breakfast'] },
            { name: 'ç…é¥¼æœå­', icon: 'ğŸŒ®', reason: 'è„†è„†çš„ï¼Œæ—©ä¸Šéœ€è¦è¿™ä¸ª', category: 'safe', time: ['breakfast'] },
            { name: 'ä¸‰æ˜æ²»', icon: 'ğŸ¥ª', reason: 'ç®€å•ä¸å¤æ‚ï¼Œåˆšåˆšå¥½', category: 'safe', time: ['breakfast', 'afternoon', 'anytime'] },
            { name: 'é¸¡è›‹çŒé¥¼', icon: 'ğŸ¥', reason: 'é¥¼é¦™è›‹å«©ï¼Œæ»¡è¶³æ„Ÿæ‹‰æ»¡', category: 'safe', time: ['breakfast'] },
            { name: 'çƒ­ç‰›å¥¶ + é¢åŒ…', icon: 'ğŸ¥›', reason: 'æ¸©æš–åˆç®€å•', category: 'light', time: ['breakfast', 'night'] },
            
            // ğŸš æ­£é¤ç±»ï¼ˆåˆé¤ + æ™šé¤ï¼‰
            { name: 'ç›–æµ‡é¥­', icon: 'ğŸš', reason: 'ç¨³å¦¥åˆä¸å‡ºé”™ï¼Œç»å…¸æ°¸ä¸è¿‡æ—¶', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'é»„ç„–é¸¡ç±³é¥­', icon: 'ğŸ—', reason: 'è®¤çœŸåƒä¸€é¡¿ï¼Œå¯¹èº«ä½“å¥½', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'ç…²ä»”é¥­', icon: 'ğŸ²', reason: 'é”…å·´é¦™è„†ï¼Œæ¸©æš–è¸å®', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'ä¸­å¼å°ç‚’', icon: 'ğŸ¥˜', reason: 'å®¶çš„å‘³é“ï¼Œåƒç€å®‰å¿ƒ', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'å·æ¹˜è¾£å‘³å¥—é¤', icon: 'ğŸŒ¶ï¸', reason: 'æƒ³åƒç‚¹æœ‰æ»¡è¶³æ„Ÿçš„ï¼Œä»Šå¤©çŠ’åŠ³è‡ªå·±', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'å®¶å¸¸èœå¥—é¤', icon: 'ğŸ±', reason: 'ä¸æ²¹è…»ä¸å¤æ‚ï¼Œåˆšåˆšå¥½', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'é¸¡æ’é¥­', icon: 'ğŸ—', reason: 'å¿«é¤é‡Œçš„ä¼˜ç­‰ç”Ÿï¼Œç¨³å®šå‘æŒ¥', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'å¤è‚‰é¥­', icon: 'ğŸ¥©', reason: 'æœ‰è‚‰æœ‰é¥­ï¼Œæ‰å®åˆæ»¡è¶³', category: 'safe', time: ['lunch', 'dinner', 'night'] },
            { name: 'å’–å–±é¥­', icon: 'ğŸ›', reason: 'æ¸©æŸ”çš„è¾£ï¼Œæš–èƒƒåˆæš–å¿ƒ', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'æ—¥å¼ä¾¿å½“', icon: 'ğŸ±', reason: 'ç²¾è‡´ä¸å°†å°±ï¼Œä½ å€¼å¾—', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'éŸ©å¼æ‹Œé¥­', icon: 'ğŸ¥—', reason: 'è¥å…»å‡è¡¡ï¼Œç…§é¡¾å¥½è‡ªå·±', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'æ³°å¼ç›–é¥­', icon: 'ğŸš', reason: 'é…¸ç”œæ¸…çˆ½ï¼Œæ¢ä¸ªå£å‘³ä¹Ÿä¸é”™', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'å®«ä¿é¸¡ä¸ç›–é¥­', icon: 'ğŸ›', reason: 'å¾®è¾£å¼€èƒƒï¼Œç»å…¸å¥½å‘³é“', category: 'safe', time: ['lunch', 'dinner'] },
            { name: 'çº¢çƒ§è‚‰å¥—é¤', icon: 'ğŸ¥©', reason: 'æƒ³åƒè‚‰çš„æ—¶å€™ï¼Œå°±è¦è®¤çœŸåƒ', category: 'safe', time: ['lunch', 'dinner'] },

            // ğŸœ ç²‰é¢æ±¤ç±»ï¼ˆå…¨å¤©é€‚ç”¨ï¼Œä½†å¤œå®µå’Œæ—©é¤æ›´åˆé€‚ï¼‰
            { name: 'æ‹‰é¢', icon: 'ğŸœ', reason: 'çƒ­çš„ä¼šè®©äººèˆ’æœä¸€ç‚¹', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'ç‰›è‚‰é¢', icon: 'ğŸœ', reason: 'æ±¤é²œè‚‰è¶³ï¼Œåƒå®Œæœ‰åŠ›æ°”', category: 'comfort', time: ['lunch', 'dinner'] },
            { name: 'ç±³çº¿', icon: 'ğŸ¥¢', reason: 'é€‚åˆæ…¢æ…¢åƒã€æ…¢æ…¢ç¼“ä¸‹æ¥', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'ç±³ç²‰', icon: 'ğŸ²', reason: 'æ¸…æ·¡å…»èƒƒï¼Œæ¸©æŸ”å¯¹å¾…è‡ªå·±', category: 'comfort', time: ['breakfast', 'lunch', 'dinner', 'night'] },
            { name: 'é…¸è¾£ç²‰', icon: 'ğŸŒ¶ï¸', reason: 'é…¸è¾£å¼€èƒƒï¼Œå¿ƒæƒ…è·Ÿç€å¥½èµ·æ¥', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'é¦„é¥¨', icon: 'ğŸ¥Ÿ', reason: 'ä¸€å£ä¸€ä¸ªå°ç¡®å¹¸', category: 'comfort', time: ['breakfast', 'lunch', 'dinner', 'night'] },
            { name: 'æ°´é¥º', icon: 'ğŸ¥Ÿ', reason: 'å®åœ¨åˆæ¸©æš–ï¼Œåƒè¢«æŠ±ä½', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'ç ‚é”…ç²¥', icon: 'ğŸ²', reason: 'æ…¢ç†¬çš„æ¸©æŸ”ï¼Œèƒƒä¼šæ„Ÿè°¢ä½ ', category: 'comfort', time: ['breakfast', 'dinner', 'night'] },
            { name: 'çš®è›‹ç˜¦è‚‰ç²¥', icon: 'ğŸ¥£', reason: 'å–å®Œæ•´ä¸ªäººéƒ½æš–äº†', category: 'comfort', time: ['breakfast', 'dinner', 'night'] },
            { name: 'èºè›³ç²‰', icon: 'ğŸœ', reason: 'æƒ³åƒç‚¹åˆºæ¿€çš„ï¼Œè®©å‘³è•¾é†’ä¸€é†’', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'äº‘åé¢', icon: 'ğŸœ', reason: 'é¢æ»‘æ±¤é²œï¼Œæ¸¯å¼çš„æ¸©æŸ”', category: 'comfort', time: ['lunch', 'dinner', 'night'] },
            { name: 'çƒ­å¹²é¢', icon: 'ğŸœ', reason: 'æµ“éƒæ‰å®ï¼Œæ­¦æ±‰äººçš„çµé­‚', category: 'comfort', time: ['breakfast', 'lunch'] },
            { name: 'æ‹…æ‹…é¢', icon: 'ğŸœ', reason: 'éº»è¾£é²œé¦™ï¼Œä¸€ç¢—å°±å¤Ÿ', category: 'comfort', time: ['lunch', 'dinner'] },

            // ğŸ— å¿«ä¹ç¢³æ°´ç±»ï¼ˆåˆé¤ã€ä¸‹åˆèŒ¶ã€æ™šé¤ã€å¤œå®µï¼‰
            { name: 'æ±‰å ¡', icon: 'ğŸ”', reason: 'ä»Šå¤©å¯ä»¥ä¸ç”¨å¤ªè‡ªå¾‹', category: 'happy', time: ['lunch', 'afternoon', 'dinner', 'night'] },
            { name: 'ç‚¸é¸¡', icon: 'ğŸ—', reason: 'å¿«ä¹ä¸€ä¸‹ä¹Ÿæ²¡å…³ç³»', category: 'happy', time: ['lunch', 'afternoon', 'dinner', 'night'] },
            { name: 'è–¯æ¡', icon: 'ğŸŸ', reason: 'ç›å’Œæ²¹è„‚æ˜¯å¿«ä¹å¯†ç ', category: 'happy', time: ['afternoon', 'night'] },
            { name: 'æŠ«è¨', icon: 'ğŸ•', reason: 'èŠå£«å°±æ˜¯åŠ›é‡', category: 'happy', time: ['lunch', 'dinner', 'night'] },
            { name: 'ç‚¸ä¸²', icon: 'ğŸ¢', reason: 'æœ‰æ—¶å€™å°±æƒ³åƒç‚¹"ä¸å¥åº·"çš„', category: 'happy', time: ['afternoon', 'dinner', 'night'] },
            { name: 'ç« é±¼å°ä¸¸å­', icon: 'ğŸ™', reason: 'ä¸€å£ä¸€ä¸ªå°ç¡®å¹¸ï¼Œæ²»æ„ˆç³»å¿«ä¹', category: 'happy', time: ['afternoon', 'night'] },
            { name: 'é¸¡ç±³èŠ±', icon: 'ğŸ—', reason: 'å°å°çš„å¿«ä¹ï¼Œä¸€é¢—æ¥ä¸€é¢—', category: 'happy', time: ['afternoon', 'night'] },

            // ğŸ¥— è½»é£Ÿå¥åº·ç±»ï¼ˆåˆé¤ã€æ™šé¤ï¼‰
            { name: 'æ²™æ‹‰', icon: 'ğŸ¥—', reason: 'åƒå®Œä¸ä¼šæœ‰è´Ÿæ‹…', category: 'light', time: ['lunch', 'dinner'] },
            { name: 'å…¨éº¦ä¸‰æ˜æ²»', icon: 'ğŸ¥ª', reason: 'ä½ å·²ç»å¾ˆåŠªåŠ›äº†', category: 'light', time: ['breakfast', 'lunch', 'afternoon'] },
            { name: 'ä½è„‚è½»é£Ÿ', icon: 'ğŸ¥™', reason: 'å¯¹è‡ªå·±å¥½ä¸€ç‚¹ï¼Œä»æ¯ä¸€é¤å¼€å§‹', category: 'light', time: ['lunch', 'dinner'] },
            { name: 'é¸¡èƒ¸è‚‰å¥—é¤', icon: 'ğŸ—', reason: 'å¥åº·ä¹Ÿå¯ä»¥å¾ˆå¥½åƒ', category: 'light', time: ['lunch', 'dinner'] },
            { name: 'ç´ é£Ÿä¾¿å½“', icon: 'ğŸ¥—', reason: 'æ¸…æ¸…çˆ½çˆ½ï¼Œæ²¡æœ‰å‹åŠ›', category: 'light', time: ['lunch', 'dinner'] },
            { name: 'è”¬èœå·', icon: 'ğŸŒ¯', reason: 'è½»ç›ˆåˆæ»¡è¶³', category: 'light', time: ['lunch', 'dinner'] },

            // ğŸ§‹ é¥®å“ç”œå“ç±»ï¼ˆä¸‹åˆèŒ¶ä¸ºä¸»ï¼‰
            { name: 'å¥¶èŒ¶', icon: 'ğŸ§‹', reason: 'ä¸ä¸€å®šé¥¿ï¼Œåªæ˜¯æƒ³è¢«å®‰æ…°', category: 'sweet', time: ['afternoon', 'night', 'anytime'] },
            { name: 'å’–å•¡', icon: 'â˜•', reason: 'éœ€è¦ä¸€ç‚¹æç¥ï¼Œä¹Ÿéœ€è¦ä¸€ç‚¹ç”œ', category: 'sweet', time: ['breakfast', 'afternoon', 'anytime'] },
            { name: 'æœèŒ¶', icon: 'ğŸ¹', reason: 'é…¸é…¸ç”œç”œï¼Œå¿ƒæƒ…è·Ÿç€è½»å¿«', category: 'sweet', time: ['afternoon', 'anytime'] },
            { name: 'é…¸å¥¶', icon: 'ğŸ¥›', reason: 'æ¸©æŸ”çš„ç”œï¼Œä¸ä¼šè…»', category: 'sweet', time: ['breakfast', 'afternoon', 'anytime'] },
            { name: 'ç”œå“', icon: 'ğŸ°', reason: 'ç³–åˆ†æ˜¯æƒ…ç»ªçš„æ­¢ç—›è¯', category: 'sweet', time: ['afternoon'] },
            { name: 'è›‹ç³•', icon: 'ğŸ‚', reason: 'ç»™è‡ªå·±ä¸€ä¸ªç”œèœœçš„ç†ç”±', category: 'sweet', time: ['afternoon'] },
            { name: 'å†°æ·‡æ·‹', icon: 'ğŸ¦', reason: 'å‡‰å‡‰çš„ç”œï¼Œçƒ¦æ¼ä¼šåŒ–æ‰ä¸€ç‚¹', category: 'sweet', time: ['afternoon', 'night'] },
            { name: 'æ³¡èŠ™', icon: 'ğŸ§', reason: 'ä¸€å£é…¥è„†ä¸€å£ç”œ', category: 'sweet', time: ['afternoon'] },
            { name: 'é©¬å¡é¾™', icon: 'ğŸ¬', reason: 'ç²¾è‡´çš„å°ç¡®å¹¸', category: 'sweet', time: ['afternoon'] },

            // ğŸ‰ è¡¥å……èƒ½é‡ç±»ï¼ˆå…¨æ—¶æ®µå¯é€‰ï¼‰
            { name: 'æ°´æœæ‹¼ç›˜', icon: 'ğŸ‰', reason: 'ä¸æƒ³åƒé¥­ä¹Ÿæ²¡å…³ç³»', category: 'light', time: ['anytime'] },
            { name: 'åšæœ', icon: 'ğŸ¥œ', reason: 'å…ˆç…§é¡¾å¥½è‡ªå·±', category: 'light', time: ['anytime'] },
            { name: 'é¢åŒ…', icon: 'ğŸ¥–', reason: 'ç®€å•ä¸€ç‚¹ï¼Œä¹ŸæŒºå¥½', category: 'light', time: ['breakfast', 'afternoon', 'night'] },
            { name: 'å°é›¶é£Ÿæ‹¼ç›˜', icon: 'ğŸª', reason: 'éšä¾¿åƒç‚¹ï¼Œåˆ«é¥¿ç€å°±è¡Œ', category: 'light', time: ['afternoon', 'night'] },

            // ğŸŒ™ å¤œå®µä¸“å±
            { name: 'çƒ§çƒ¤', icon: 'ä¸²', reason: 'å¤œæ™šçš„ä»ªå¼æ„Ÿ', category: 'happy', time: ['night'] },
            { name: 'éº»è¾£çƒ«', icon: 'ğŸ²', reason: 'æ·±å¤œé£Ÿå ‚ï¼Œæƒ³åƒå°±åƒ', category: 'comfort', time: ['night', 'dinner'] },
            { name: 'ç‚’ç²‰', icon: 'ğŸœ', reason: 'å¤œå®µå°±è¯¥è¿™ä¹ˆåƒ', category: 'comfort', time: ['night'] },
            { name: 'å°é¾™è™¾', icon: 'ğŸ¦', reason: 'ä»Šæ™šæ”¾çºµä¸€ä¸‹', category: 'happy', time: ['night', 'dinner'] },
            { name: 'å…³ä¸œç…®', icon: 'ğŸ¢', reason: 'æš–æš–çš„ï¼Œé™ªä½ åˆ°æ·±å¤œ', category: 'comfort', time: ['night'] },
            { name: 'ç…é¥º', icon: 'ğŸ¥Ÿ', reason: 'è„†è„†çš„åº•ï¼Œæ»¡æ»¡çš„é¦…', category: 'comfort', time: ['night', 'breakfast'] }
        ];

        // ã€å¯ä¿®æ”¹ã€‘å½©è›‹æ¦‚ç‡è®¾ç½®
        const EASTER_EGG_PROBABILITY = 0.08; // 8% å¸¸è§„å½©è›‹
        const RARE_EASTER_EGG_PROBABILITY = 0.01; // 1% ç¨€æœ‰å½©è›‹ï¼ˆç³»ç»ŸçœŸç›¸ï¼‰
        const UPGRADE_PROBABILITY = 0.15; // 15% å‡çº§æç¤º
        
        // ã€å¯ä¿®æ”¹ã€‘å…œåº•è§¦å‘é˜ˆå€¼ï¼ˆè¿ç»­çº ç»“æ¬¡æ•°ï¼‰
        const HESITATION_THRESHOLD = 2; // è¿ç»­2æ¬¡çº ç»“è§¦å‘"æˆ‘è¯·"
        const PROTECTION_THRESHOLD = 3; // è¿ç»­3æ¬¡è§¦å‘ä¿æŠ¤
        
        // ã€å¯ä¿®æ”¹ã€‘å½©è›‹æ±  - å®Œæ•´ç‰ˆ
        const easterEggs = [
            // Aç±»ï¼šä½æˆæœ¬å½©è›‹
            { 
                icon: 'ğŸ’', 
                text: 'ä»Šæ—¥ç‚¹å•æƒå·²è¢«æˆ‘æ¥ç®¡\nä½ è´Ÿè´£ç­‰å¤–å–\næˆ‘è´Ÿè´£æƒ³ä½ åƒä»€ä¹ˆ', 
                button: 'å¥½å§ï¼Œäº¤ç»™ä½ ',
                type: 'normal'
            },
            { 
                icon: 'ğŸ', 
                text: 'ä½ å·²ç»çº ç»“å¤Ÿä¹…äº†\nç°åœ¨å¼€å§‹ï¼Œæˆ‘æ›¿ä½ å†³å®š', 
                button: 'å¬ä½ çš„',
                type: 'normal'
            },
            
            // Bç±»ï¼šä¸­çº§å½©è›‹
            { 
                icon: 'ğŸ’', 
                text: 'åˆ«ç‚¹å¤–å–äº†\nä»Šå¤©æˆ‘å¸¦ä½ å‡ºå»åƒ', 
                button: 'å¼€å¯çº¦ä¼šæ¨¡å¼',
                type: 'normal'
            },
            
            // Cç±»ï¼šé«˜æƒ…ç»ªä»·å€¼å½©è›‹
            { 
                icon: 'â¤ï¸', 
                text: 'æœ¬ç³»ç»Ÿå­˜åœ¨çš„å”¯ä¸€ç›®çš„ï¼š\nä¸è®©ä½ ä¸€ä¸ªäººçº ç»“', 
                button: 'æˆ‘çŸ¥é“äº†',
                type: 'rare'
            },
            { 
                icon: 'ğŸ‘¨â€ğŸ³', 
                text: 'ä»Šå¤©ä¸åƒå¤–å–\nåƒæˆ‘åšçš„ / åƒæˆ‘é™ªçš„', 
                button: 'å¥½å‘€',
                type: 'normal'
            },
            { 
                icon: 'ğŸŒ™', 
                text: 'ä¸æƒ³åƒä¹Ÿæ²¡å…³ç³»\nè¦ä¸è¦æˆ‘é™ªä½ ä¸€ä¼šå„¿', 
                button: 'å¥½å‘€',
                type: 'normal'
            }
        ];

        // ==================== æ ¸å¿ƒé€»è¾‘ ====================
        
        let drawCount = 0;
        let hesitationCount = 0;
        let lastResults = [];
        let totalCount = parseInt(localStorage.getItem('lms_total_count') || '0');
        let lastDrawDate = localStorage.getItem('lms_last_date') || '';
        let todayDrawCount = 0;

        const drawButton = document.getElementById('drawButton');
        const resultCard = document.getElementById('resultCard');
        const actionButtons = document.getElementById('actionButtons');
        const confirmBtn = document.getElementById('confirmBtn');
        const retryBtn = document.getElementById('retryBtn');
        const timeBadge = document.getElementById('timeBadge');
        const todayCount = document.getElementById('todayCount');
        const specialMessage = document.getElementById('specialMessage');
        const overlay = document.getElementById('overlay');
        const specialIcon = document.getElementById('specialIcon');
        const specialText = document.getElementById('specialText');
        const specialBtn = document.getElementById('specialBtn');

        // è·å–å½“å‰æ—¶æ®µ
        function getCurrentTimePeriod() {
            const hour = new Date().getHours();
            if (hour >= 6 && hour < 10.5) return 'breakfast';
            if (hour >= 10.5 && hour < 14) return 'lunch';
            if (hour >= 14 && hour < 17) return 'afternoon';
            if (hour >= 17 && hour < 21) return 'dinner';
            return 'night';
        }

        // æ ¹æ®æ—¶æ®µè¿‡æ»¤é£Ÿç‰©é€‰é¡¹
        function getAvailableFoods() {
            const currentPeriod = getCurrentTimePeriod();
            return foodOptions.filter(food => 
                food.time.includes(currentPeriod) || food.time.includes('anytime')
            );
        }

        // åˆå§‹åŒ–
        function init() {
            updateTimeBadge();
            checkDate();
            todayCount.textContent = totalCount;
        }

        // æ£€æŸ¥æ—¥æœŸï¼Œé‡ç½®å½“æ—¥è®¡æ•°
        function checkDate() {
            const today = new Date().toDateString();
            if (lastDrawDate !== today) {
                todayDrawCount = 0;
                localStorage.setItem('lms_last_date', today);
            }
        }

        // æ›´æ–°æ—¶é—´å¾½ç« 
        function updateTimeBadge() {
            const hour = new Date().getHours();
            let mode = 'å¤œå®µæ¨¡å¼';
            if (hour >= 6 && hour < 10.5) mode = 'æ—©é¤æ¨¡å¼';
            else if (hour >= 10.5 && hour < 14) mode = 'åˆé¤æ¨¡å¼';
            else if (hour >= 14 && hour < 17) mode = 'ä¸‹åˆèŒ¶æ¨¡å¼';
            else if (hour >= 17 && hour < 21) mode = 'æ™šé¤æ¨¡å¼';
            timeBadge.textContent = mode;
        }

        // è·å–æ—¶é—´ç›¸å…³çš„æ¸©é¦¨æç¤º
        function getTimeBasedMessage() {
            const hour = new Date().getHours();
            if (hour >= 6 && hour < 9 && todayDrawCount === 1) {
                return { icon: 'ğŸŒ…', text: 'æ—©ä¸Šè¦å¥½å¥½åƒ\nä¸€å¤©æ‰ä¼šæœ‰ç²¾ç¥', button: 'çŸ¥é“å•¦' };
            }
            if (hour >= 18 && hour < 21) {
                return { icon: 'â°', text: 'æ™šä¸Šä¸è¦éšä¾¿åº”ä»˜\nåƒç‚¹çƒ­çš„ï¼Œæˆ‘æ”¾å¿ƒä¸€ç‚¹', button: 'å¥½çš„' };
            }
            if (hour >= 21 || hour < 6) {
                return { icon: 'ğŸŒ™', text: 'è¿™ä¹ˆæ™šäº†\nåƒç‚¹æ¸…æ·¡çš„ï¼Œå¯¹èƒƒå¥½', button: 'å¬ä½ çš„' };
            }
            return null;
        }

        // æ£€æŸ¥æ˜¯å¦å‘¨äº”ï¼ˆçº¦ä¼šæ¨¡å¼ï¼‰
        function isFriday() {
            return new Date().getDay() === 5;
        }

        // æŠ½å–é€»è¾‘
        function draw() {
            drawCount++;
            todayDrawCount++;
            totalCount++;
            localStorage.setItem('lms_total_count', totalCount);
            todayCount.textContent = totalCount;

            // ğŸ† å½©è›‹ 10ï¼šå¿ å®ç”¨æˆ·æˆå°±
            if (totalCount === 10) {
                showSpecialMessage('ğŸ†', 'æ„Ÿæƒ…ç®¡ç†ç³»ç»Ÿè¿è¡Œç¨³å®š\nç”¨æˆ·æ»¡æ„åº¦ï¼š100%', 'ç»§ç»­ä½¿ç”¨');
                return;
            }

            // ğŸ† å½©è›‹ 11ï¼šè¿‡åº¦çº ç»“ä¿æŠ¤
            if (hesitationCount >= PROTECTION_THRESHOLD) {
                showSpecialMessage('ğŸ›¡ï¸', 'å·²æ£€æµ‹åˆ°ä½ åœ¨ä¸ºéš¾è‡ªå·±\nå»ºè®®åœæ­¢çº ç»“\næ”¹ä¸ºï¼šè¢«ç…§é¡¾', 'æˆ‘å¬è¯');
                hesitationCount = 0;
                return;
            }

            // ğŸ’¥ å½©è›‹ 5ï¼šæˆ‘è¯·ï¼ˆè¿ç»­2æ¬¡é‡é€‰è§¦å‘ï¼‰
            if (hesitationCount >= HESITATION_THRESHOLD) {
                showSpecialMessage('ğŸ’°', 'è¿™é¡¿æˆ‘è¯·\nä½ ä¸ç”¨ç®—æ€§ä»·æ¯”\nç‚¹ä½ çœŸæ­£æƒ³åƒçš„', 'é‚£æˆ‘ä¸å®¢æ°”äº†');
                hesitationCount = 0;
                return;
            }

            // ğŸ’¥ å½©è›‹ 6ï¼šç…§é¡¾å‹æç¤ºï¼ˆæ—¶æ®µç›¸å…³ï¼‰
            const timeMessage = getTimeBasedMessage();
            if (timeMessage && Math.random() < 0.3) {
                showSpecialMessage(timeMessage.icon, timeMessage.text, timeMessage.button);
                return;
            }

            // ğŸ’¥ å½©è›‹ 4ï¼šçº¦ä¼šæ¨¡å¼ï¼ˆå‘¨äº”å¿…å‡ºæˆ–8%æ¦‚ç‡ï¼‰
            if (isFriday() && todayDrawCount === 1) {
                showSpecialMessage('ğŸ’', 'åˆ«ç‚¹å¤–å–äº†\nä»Šå¤©æˆ‘å¸¦ä½ å‡ºå»åƒ', 'å¼€å¯çº¦ä¼šæ¨¡å¼');
                return;
            }

            // â¤ï¸ å½©è›‹ 7ï¼šç³»ç»ŸçœŸç›¸ï¼ˆ1%ç¨€æœ‰ï¼‰
            if (Math.random() < RARE_EASTER_EGG_PROBABILITY) {
                const rareEggs = easterEggs.filter(e => e.type === 'rare');
                const egg = rareEggs[Math.floor(Math.random() * rareEggs.length)];
                showSpecialMessage(egg.icon, egg.text, egg.button);
                return;
            }

            // å¸¸è§„å½©è›‹è§¦å‘ï¼ˆ8%ï¼‰
            if (Math.random() < EASTER_EGG_PROBABILITY) {
                const normalEggs = easterEggs.filter(e => e.type === 'normal');
                const egg = normalEggs[Math.floor(Math.random() * normalEggs.length)];
                showSpecialMessage(egg.icon, egg.text, egg.button);
                return;
            }

            // æ­£å¸¸æŠ½å– - æ ¹æ®æ—¶æ®µè¿‡æ»¤
            const availableFoods = getAvailableFoods();
            if (availableFoods.length === 0) {
                showSpecialMessage('ğŸ˜…', 'å½“å‰æ—¶æ®µæš‚æ— åˆé€‚çš„é€‰é¡¹\nè¦ä¸è¦æ¢ä¸ªæ—¶é—´å†è¯•è¯•', 'å¥½çš„');
                return;
            }
            
            const result = availableFoods[Math.floor(Math.random() * availableFoods.length)];
            lastResults.push(result);
            if (lastResults.length > 2) lastResults.shift();

            // ğŸ å½©è›‹ 2ï¼šå‡çº§æç¤ºï¼ˆæŠ½åˆ°å¿«é¤ç±»15%æ¦‚ç‡ï¼‰
            if (result.category === 'safe' && Math.random() < UPGRADE_PROBABILITY) {
                showSpecialMessage('â­', 'æœ¬æ¥ç‚¹å¿«é¤\nä½†ä½ å€¼å¾—åƒå¥½ä¸€ç‚¹\n\nå»ºè®®ï¼šå‡çº§ä½ æœ€çˆ±çš„é‚£å®¶', 'å°±è¿™ä¹ˆåŠ');
                return;
            }

            showResult(result);
        }

        // æ˜¾ç¤ºç»“æœ
        function showResult(result) {
            drawButton.disabled = true;
            resultCard.classList.add('shuffle');

            setTimeout(() => {
                resultCard.classList.remove('shuffle');
                resultCard.querySelector('.card-icon').textContent = result.icon;
                resultCard.querySelector('.card-title').textContent = result.name;
                resultCard.querySelector('.card-description').textContent = result.reason;
                
                actionButtons.classList.add('show');
                drawButton.disabled = false;
            }, 600);
        }

        // æ˜¾ç¤ºç‰¹æ®Šæ¶ˆæ¯
        function showSpecialMessage(icon, text, buttonText) {
            specialIcon.textContent = icon;
            specialText.textContent = text;
            specialBtn.textContent = buttonText;
            
            overlay.classList.add('show');
            specialMessage.classList.add('show');
        }

        // å…³é—­ç‰¹æ®Šæ¶ˆæ¯
        function closeSpecialMessage() {
            overlay.classList.remove('show');
            specialMessage.classList.remove('show');
        }

        // ç¡®è®¤é€‰æ‹©
        function confirm() {
            hesitationCount = 0;
            showSpecialMessage('âœ…', 'å·²æ‰¹å‡†\nå»ä¸‹å•å§\nè®°å¾—å¥½å¥½åƒé¥­', 'éµå‘½');
            actionButtons.classList.remove('show');
        }

        // é‡æ–°çº ç»“
        function retry() {
            hesitationCount++;
            actionButtons.classList.remove('show');
            
            // ğŸ å½©è›‹ 3ï¼šæ£€æŸ¥è¿ç»­è½»é£Ÿçº ç»“ï¼ˆå…œåº•é€»è¾‘ï¼‰
            if (lastResults.length >= 2) {
                const lastTwo = lastResults.slice(-2);
                const bothLight = lastTwo.every(r => r.category === 'light');
                if (bothLight) {
                    hesitationCount = HESITATION_THRESHOLD; // ç›´æ¥è§¦å‘"æˆ‘è¯·"
                }
            }
        }

        // äº‹ä»¶ç›‘å¬
        drawButton.addEventListener('click', draw);
        confirmBtn.addEventListener('click', confirm);
        retryBtn.addEventListener('click', retry);
        specialBtn.addEventListener('click', closeSpecialMessage);
        overlay.addEventListener('click', closeSpecialMessage);

        // åˆå§‹åŒ–
        init();
    </script>
</body>
</html>
